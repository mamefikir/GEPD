---
title: "Global Education Policy Dashboard"
author: "Education Global Practice, World Bank"
date: "10/22/2019"
output: powerpoint_presentation

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

#include packages
library(tidyverse)
library(haven)
library(kableExtra)
library(skimr)
library(flextable)
library(ggridges)
library(scales)
```

##



## Introduction


- The Global Education Policy Dashboard  applies framework of WDR 2018 

- Create and collect a concise set of indicators that allow tracking of key determinants of learning.  

- The Dashboard tracks three levels, the three Ps:
  * Practice
  * Policies
  * Politics.

## Survey of Public Officials

- The Policy Dashboard survey includes the politics, or the political and bureaucratic environment in which those policies are created and implemented:  
  * Are there political incentives and bureaucratic capacity to deliver learning for all children?  


## Survey Details

- Sample a total of 200 public officials.  

- Roughly 60 officials will be surveyed at the federal level
  *  Interview the HR director, finance director, planning director, and three randomly selected service focused departments.  
  *  Sample of 9 professional employees chosen at random from service departments.

- 140 officials surveyed at regional/district level.  
  * Selected from Districts/Regions where we survey schools
  * 7 officials will sampled each office:
    * Head of organization, HR director, two division directors from finance and planning, and 3 randomly selected professional employees 

```{r data, include=FALSE}

#set directory to bring in data

work_dir<- "C:/Users/wb469649/WBG/Ezequiel Molina - Dashboard (Team Folder)/Country_Work/Peru/2019/Data/clean/"

#load public official data
load(paste(work_dir, "Public_Officials/public_officials_indicators_data.RData", sep=""))

#load school data for comparisons
load(paste(work_dir, "School/school_indicators_data.RData", sep=""))

#Load original sample of schools
currentDate<-c("2019-07-22")
sample_frame_name <- paste("C:/Users/WB469649/WBG/Ezequiel Molina - Dashboard (Team Folder)/Country_Work/Peru/2019/Data/sampling/school_sample_",currentDate,".RData", sep="")

load(sample_frame_name)

#compare data collected to original sample
school_dta_short <- school_dta_short %>%
  mutate(codigo.modular=as.numeric(school_code_preload)) %>%
  left_join(data_set_updated) %>%
  mutate(longitude=as.character(longitude)) %>%
  mutate(latitude=as.character(latitude)) %>%
  mutate(lat=if_else(is.na(lat), as.numeric(latitude), lat),
         lon=if_else(is.na(lon), as.numeric(longitude), lon),
         school_ipw=weights)

#Create a function which will generate new binary variable using case_when, but 
#if value is misisng it will generate binary variable to be missing
#This is done a lot so will create function for it.
#e.g. school_absent=case_when(
#         m2sbq6_efft==6  ~ 1,
#         m2sbq6_efft!=6   ~ 0,
#         is.na(m2sbq6_efft) ~ as.numeric(NA))
bin_var <- function(var, val) {
  case_when(
    var==val  ~ 1,
    var!=val   ~ 0,
    is.na(var) ~ as.numeric(NA))
}


```


## Urban/Rural Breakdowns

```{r urban_rural}


urban_rural <- school_dta_short %>%
  mutate(Type=factor(rural, levels=c("TRUE", "FALSE"), labels = c("Rural", "Urban"))) %>%
  filter(!is.na(rural))

infr_urban_rural <-ggplot(urban_rural, aes(x=infrastructure, y=Type, fill=Type)) +
  geom_density_ridges() +
  labs(x='Infrastructure Index')+
  ggtitle("Infrastructure Across Urban/Rural")

infr_urban_rural

infr_urban_rural <- urban_rural %>%
  ggplot(aes(x=infrastructure, fill=Type))  +
    geom_density( alpha=0.4) +
    theme_bw() +
  labs(x='Infrastructure Index')+
  ggtitle("Infrastructure Across Urban/Rural")
  
infr_urban_rural

```




## Do public officials know the National Learning Goals?

```{r nlg, echo=FALSE}

cat_data <- public_officials_dta_clean %>%
  mutate(NLG1q1_cat_1=bin_var(NLG1q1,1),
         NLG1q1_cat_2=bin_var(NLG1q1,2),
         NLG1q1_cat_3=bin_var(NLG1q1,3),
         NLG1q1_cat_4=bin_var(NLG1q1,4),
         NLG1q1_cat_5=bin_var(NLG1q1,5),
         NLG1q1_cat_dn=bin_var(NLG1q1,900)) %>%
  mutate(NLG1q1_factor=factor(NLG1q1, levels=c(1,2,3,4,5,900),
                              labels=c("The organization does not have defined targets",
                                       "The organization has only loosely-defined targets",
                                       "The organization has clearly-defined targets at the organization-level only but these are only loosely related to national learning goals and are not clearly quantifiable",
                                       "There are clearly-defined, quantifiable targets for the organization, as well as for some units/individuals within the organization; these are closely related to national learning goals",
                                       "There are clearly-defined, quantifiable targets for the organization, units and individual staff members within the organization, all closely related to national learning goals",
                                       "Don't Know"))) 

cat_data %>%
  count(NLG1q1_factor = NLG1q1_factor) %>% 
  mutate(pct = prop.table(n)) %>%
  ggplot( aes(x=NLG1q1_factor, y=pct)) + #now plot the output in a bar graph
    geom_col(aes(fill='darkblue')) +
    geom_label(aes(label=scales::percent(pct)), size = 3) +
    scale_y_continuous(labels=percent) +
    scale_x_discrete(labels = str_wrap(c("The organization does not have defined targets",
                                       "The organization has only loosely-defined targets",
                                       "The organization has clearly-defined targets at the organization-level only but these are only loosely related to national learning goals and are not clearly quantifiable",
                                       "There are clearly-defined, quantifiable targets for the organization, as well as for some units/individuals within the organization; these are closely related to national learning goals",
                                       "There are clearly-defined, quantifiable targets for the organization, units and individual staff members within the organization, all closely related to national learning goals",
                                       "Don't Know"), width = 25)) + 
  xlab(str_wrap("Does your organization have a clear set of performance indicators? Are targets aligned with and contribute to achieving learning goals at the national level?", width=75))+
  ylab("Percent") +
  ggtitle(str_wrap("Public Officials Opinions on Whether Performance Indicators Aligned with National Learning Goals", width=75)) +
  theme_bw() +
    theme(legend.position = "none") 

```


- When asked, "Does your organization have a clear set of performance indicators? Are targets aligned with and contribute to achieving learning goals at the national level?"

  * `r 100*round(mean(cat_data$NLG1q1_cat_1, na.rm=T),2)`% reported "The organization does not have defined targets"
  * `r 100*round(mean(cat_data$NLG1q1_cat_2, na.rm=T),2)`% reported "The organization has only loosely-defined targets"
  * `r 100*round(mean(cat_data$NLG1q1_cat_3, na.rm=T),2)`% reported "The organization has clearly-defined targets at the organization-level only but these are only loosely related to national learning goals and are not clearly quantifiable."
  * `r 100*round(mean(cat_data$NLG1q1_cat_4, na.rm=T),2)`% reported "There are clearly-defined, quantifiable targets for the organization, as well as for some units/individuals within the organization; these are closely related to national learning goals."
  * `r 100*round(mean(cat_data$NLG1q1_cat_5, na.rm=T),2)`% reported "There are clearly-defined, quantifiable targets for the organization, units and individual staff members within the organization, all closely related to national learning goals."  

## Do public officials feel accountability?

```{r mac, include=FALSE}

cat_data_mac <- public_officials_dta_clean %>%
  mutate(ACM4q3_cat_1=bin_var(ACM4q3,1),
         ACM4q3_cat_2=bin_var(ACM4q3,2),
         ACM4q3_cat_3=bin_var(ACM4q3,3),
         ACM4q3_cat_4=bin_var(ACM4q3,4),
         ACM4q3_cat_5=bin_var(ACM4q3,5),
         ACM4q3_cat_dn=bin_var(ACM4q3,900))

```


- When asked, "What would happen if an official distorted the procurement process for private benefit?"

  * `r 100*round(mean(cat_data_mac$ACM4q3_cat_1, na.rm=T),2)`% reported "No one is held accountable"
  * `r 100*round(mean(cat_data_mac$ACM4q3_cat_2, na.rm=T),2)`% reported "They are informally held accountable by higher authorities"
  * `r 100*round(mean(cat_data_mac$ACM4q3_cat_3, na.rm=T),2)`% reported "They are held accountable by their organization through their formal performance appraisal, however the consequences are unclear"
  * `r 100*round(mean(cat_data_mac$ACM4q3_cat_4, na.rm=T),2)`% reported "They are formally held accountable by their organization through their formal performance appraisal with relevant reporting and follow up to higher authorities. However, the consequences are unclear"
  * `r 100*round(mean(cat_data_mac$ACM4q3_cat_5, na.rm=T),2)`% reported "They are formally held accountable by their organization through their formal performance appraisal with relevant reporting and follow up to higher authorities. There are clear consequences"  


## Are they motivated to do their jobs?

```{r mot, include=FALSE}

cat_data_mot <- public_officials_dta_clean %>%
  mutate(QB4q2_cat_1=bin_var(QB4q2,1),
         QB4q2_cat_2=bin_var(QB4q2,2),
         QB4q2_cat_3=bin_var(QB4q2,3),
         QB4q2_cat_4=bin_var(QB4q2,4),
         QB4q2_cat_5=bin_var(QB4q2,5),
         QB4q2_cat_dn=bin_var(QB4q2,900))

```


- When asked, "Imagine that when you started your motivation was 100. What number would you say your motivation was now relative to that?"

  * `r 100*round(mean(cat_data_mot$QB4q2_cat_1, na.rm=T),2)`% reported "Less than 80% of prior motivation"
  * `r 100*round(mean(cat_data_mot$QB4q2_cat_2, na.rm=T),2)`% reported "80-90% as motivated"
  * `r 100*round(mean(cat_data_mot$QB4q2_cat_3, na.rm=T),2)`% reported "90-100% as motivated"
  * `r 100*round(mean(cat_data_mot$QB4q2_cat_4, na.rm=T),2)`% reported ""100-110% as motivated"
  * `r 100*round(mean(cat_data_mot$QB4q2_cat_5, na.rm=T),2)`% reported "More than 120% as motivated as when started"  

## Do public officials know their schools?

- Class Size:
  * Public officials asked, "What is the average class size in a typical 4th-grade class?"
  * We can compare answer to average calculated in our school survey
  
- Absence:
  * Public officials asked, "What percent of their time do you think teachers are absent without providing justification?"
  * We can compare answer to average calculated in our school survey

## Public officials class size answers

```{r include=FALSE}

weights<-school_dta_short %>%
  group_by(school_code) %>%
  summarise(school_ipw=mean(school_ipw))

final_indicator_data_INPT <- final_indicator_data_INPT %>%
  left_join(weights) %>%
  filter(!is.na(school_ipw))

class_size <- weighted.mean(final_indicator_data_INPT$m4scq4_inpt, w=final_indicator_data_INPT$school_ipw, na.rm=TRUE)

```

- The average 4th grade class size according to our survey is `r round(class_size, 2)` students per class.

```{r class_size, include=FALSE}

class_size_public_officials <- public_officials_dta_clean %>%
  group_by(govt_tier) %>%
  select(govt_tier, avg_class_size_guess) %>%
  mutate(avg_class_size_guess=as.character(avg_class_size_guess)) %>%
  mutate(avg_class_size_guess=as.numeric(avg_class_size_guess)) %>%
  mutate(avg_class_size_dn=if_else(avg_class_size_guess==900, 1,0))

class_size_dn <-mean(class_size_public_officials$avg_class_size_dn , na.rm=TRUE)

sumstats_class_size <- class_size_public_officials %>%
  select(govt_tier, avg_class_size_guess) %>%
  filter(avg_class_size_guess!=900 & avg_class_size_guess!=998 ) %>%
  group_by(govt_tier) %>%
  skim() %>%
  select(-level, -type, -value) %>%
  spread(stat, formatted) %>%
  select(govt_tier, variable, mean, sd, p0, p25, p50, p75, p100, complete, missing, hist, n) %>%
  mutate(ci_low=as.numeric(mean)-1.96*(as.numeric(sd)/sqrt(as.numeric(complete))),
         ci_high=as.numeric(mean)+1.96*(as.numeric(sd)/sqrt(as.numeric(complete)))) %>%
  mutate(ci=paste("[",round(ci_low,2),", ", round(ci_high,2),"]", sep="")) %>%
  select(govt_tier,  mean, ci, sd, p25, p75,n)


```

- `r 100*round(class_size_dn,2)`% of public officials reported "Don't Know"
- For those that did guess, here are the means by office type:

```{r class_size_guesses, echo=FALSE}

sumstats_class_size %>%
  flextable() %>%
  theme_zebra() %>% autofit()

```



## Public officials absence answers

```{r include=FALSE}

school_absence <- school_dta_short %>%
  filter(!is.na(school_ipw))

absence <- weighted.mean(school_absence$absence_rate, w=school_absence$school_ipw, na.rm=TRUE)

```

- The absence rate for teachers according to our school survey is `r 100*round(absence, 2)`%.

```{r absence, include=FALSE}

absence_public_officials <- public_officials_dta_clean %>%
  group_by(govt_tier) %>%
  select(govt_tier, avg_absence_guess) %>%
  mutate(avg_absence_guess=as.character(avg_absence_guess)) %>%
  mutate(avg_absence_guess=as.numeric(avg_absence_guess)) %>%
  mutate(avg_absence_guess_dn=if_else(avg_absence_guess==900, 1,0))

absence_dn <-mean(absence_public_officials$avg_absence_guess_dn , na.rm=TRUE)

sumstats_absence <- absence_public_officials %>%
  select(govt_tier, avg_absence_guess) %>%
  filter(avg_absence_guess!=900 & avg_absence_guess!=998 ) %>%
  group_by(govt_tier) %>%
  skim() %>%
  select(-level, -type, -value) %>%
  spread(stat, formatted) %>%
  select(govt_tier, variable, mean, sd, p0, p25, p50, p75, p100, complete, missing, hist, n) %>%
  mutate(ci_low=as.numeric(mean)-1.96*(as.numeric(sd)/sqrt(as.numeric(complete))),
         ci_high=as.numeric(mean)+1.96*(as.numeric(sd)/sqrt(as.numeric(complete)))) %>%
  mutate(ci=paste("[",round(ci_low,2),", ", round(ci_high,2),"]", sep="")) %>%
  select(govt_tier,  mean, ci, sd, p25, p75,n)


```

- `r 100*round(absence_dn,2)`% of public officials reported "Don't Know"
- For those that did guess, here are the means by office type:

```{r absence_guesses, echo=FALSE}

sumstats_absence %>%
  flextable() %>%
  theme_zebra() %>% autofit()

```


## Do public officials feel decision making is impartial?

```{r imp, include=FALSE}

cat_data_imp <- public_officials_dta_clean %>%
  mutate(IDM1q1_cat_1=bin_var(IDM1q1,1),
         IDM1q1_cat_2=bin_var(IDM1q1,2),
         IDM1q1_cat_3=bin_var(IDM1q1,3),
         IDM1q1_cat_4=bin_var(IDM1q1,4),
         IDM1q1_cat_5=bin_var(IDM1q1,5),
         IDM1q1_cat_dn=bin_var(IDM1q1,900))

```


- When asked, "To what extent would you agree that hiring decisions in your organization are more likely to be based on political connections than on merit?"

  * `r 100*round(mean(cat_data_imp$IDM1q1_cat_5, na.rm=T),2)`% reported "Strongly Disagree"
  * `r 100*round(mean(cat_data_imp$IDM1q1_cat_4, na.rm=T),2)`% reported "Disagree"
  * `r 100*round(mean(cat_data_imp$IDM1q1_cat_2, na.rm=T),2)`% reported "Agree"
  * `r 100*round(mean(cat_data_imp$IDM1q1_cat_1, na.rm=T),2)`% reported "Strongly Agree"  

## What is the overall picture?

- Five sub-indicators:
  * National Learning Goals
  * Mandates and Accountability
  * Quality of Bureaucracy
  * Impartial Decision Making
  * Financing
- Each measure scaled 1-5, with 5 best  

## Overal Picture

```{r overall_stats, include=FALSE}

overall_public_officials <- public_officials_dta_clean %>%
  group_by(govt_tier) %>%
  select(govt_tier, national_learning_goals,mandates_accountability ,quality_bureaucracy, impartial_decision_making) 



sumstats_overall <- overall_public_officials %>%
  group_by(govt_tier) %>%
  skim() %>%
  select(-level, -type, -value) %>%
  spread(stat, formatted) %>%
  select(govt_tier, variable, mean, sd, p0, p25, p50, p75, p100, complete, missing, hist, n) %>%
  mutate(ci_low=as.numeric(mean)-1.96*(as.numeric(sd)/sqrt(as.numeric(complete))),
         ci_high=as.numeric(mean)+1.96*(as.numeric(sd)/sqrt(as.numeric(complete)))) %>%
  mutate(ci=paste("[",round(ci_low,2),", ", round(ci_high,2),"]", sep="")) %>%
  select(govt_tier, variable, mean, ci, sd, p25, p75,n)

```

```{r overall_stats_table, echo=FALSE}

sumstats_overall %>%
  flextable() %>%
  theme_zebra() %>% autofit()

```
