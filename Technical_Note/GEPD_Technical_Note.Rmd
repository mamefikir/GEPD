---
title: "GEPD Technical Note"
author: "Brian Stacy"
date: "1/21/2020"
output:
  pdf_document:
    toc: yes
  html_document:
    df_print: paged
    toc: yes
  word_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(knitr)
library(captioner)
#produce caption for tables/figures
  tab_num<-captioner(prefix="Table")
  fig_num<-captioner(prefix="Figure")
```

# NEED TO ADD Decision points document.  

1. Stop light system scoring
2. 1st grade assessment
      
      
# Background on Project
Policymakers in low- and middle-income countries who are working to improve student learning often find themselves flying blind. They see the budget that goes into education and (sometimes) the learning that students come out with, but they lack information on the crucial factors in between— the practices, policies, and politics—that drive those learning outcomes. The new Global Education Policy Dashboard initiative will fill that gap.

## The Challenge: Understanding the Learning Crisis
Many countries, despite having significantly increased access to education for their children and youth, now realize that they are facing a learning crisis. For instance, when grade 3 students in Nicaragua were tested in 2011, only half correctly solved 5 + 6. And in Kenya, Tanzania, and Uganda, when grade 3 students were asked recently to read a sentence such as  “The  name  of  the  dog  is  Puppy,”  three-quarters could  not  answer  what  the  dog’s  name  was.  Examples like these from around the world underline that schooling is not the same as learning—even though education policy often assumes that it is.

The World Development Report 2018 argued that the learning crisis has both micro- and system-level causes: poor service delivery in schools and communities, driven by unhealthy politics and low bureaucratic capacity, mediated through policies that are not aligned toward learning for all. To tackle the crisis and improve student learning at scale, countries need to know where they stand on all three of these dimensions—practices (or service delivery), policies, and politics.

But providing such a systemwide overview requires better measurement. Many of these drivers of learning are not captured by existing administrative systems. And although new measurement tools capture some of those aspects well, no single instrument pulls together data on all these areas. This gap leaves policymakers in the dark about what is working and what isn’t.

## Our Response: Shining a light on the drivers of learning
To fill this gap, the World Bank, with support from the Bill and Melinda Gates Foundation and the UK’s Department for International Development, is designing a Global Education Policy Dashboard, which will measure the drivers of learning outcomes in basic education around the world. In doing so, it will highlight gaps between current practice and  what the evidence suggests would be most effective in promoting learning, and it will give governments a way to set priorities and track progress as they work to close those gaps. This collaboration will advance the goals of the Human Capital Project, a global effort to accelerate more and better investments in people for greater equity and economic growth.

The dashboard will start by focusing attention on education outcomes—learning and participation in primary school.  The next set of indicators will measure the quality of service delivery, focusing on four key school-level ingredients of student learning:  teaching, school management, technology for learning, and learner preparation.  

In addition, the dashboard will measure deeper systemic drivers: the policies and politics that determine the quality of service delivery. The end goal is to have a set of indicators that is comprehensive but also focused so stakeholders can pay attention to what is really most important.

The dashboard will be implemented in 13 countries in 2019, with a goal of rapidly expanding coverage after lessons from the field have been incorporated.

## Our Approach: How the Dashboard will achieve this
Develop tools to collect data at all levels of the system on a regular basis. Because of the shortcomings of existing data on the drivers of learning, in its early stage the dashboard will rely primarily on data collected under this initiative, rather than just presenting existing data in a new framework. In each participating country, the initiative will deploy various new data-collection instruments, including a School Survey, an Expert Survey, and a Survey of Public Officials. This multilevel approach is necessary to gather data on all the drivers of learning, from the level of the learner to the level of the system. The aim is to develop lean and cost-effective instruments so the dashboard can be inexpensive enough to be applied repeatedly and to be scaled up after initial phasing.

Embed innovative measurement approaches in a coherent, system-wide framework. The  dashboard  approach  combines  the conceptual framework of the World Development Report 2018 with indicators derived from streamlined versions of the most current measurement tools. These tools include the Service Delivery Indicators (SDI) initiative, Systems Approach for Better Results (SABER), Global Early Child Development Database (GECDD), World Management Survey, Bureaucracy Lab surveys, and others.

Present a user-friendly dashboard interface. After gathering data, the dashboard initiative  will  display  the  indicators  in   an easy-to-use interface, focusing attention on key constraints. The primary audience will be policymakers, placing a premium on a visual representation that illuminates key relationships and constraints on learning.

Make resources available for implementation in all developing countries. Along with  developing  the  dashboard  and  implementing it in an initial set of 13 countries, the World Bank and partners will create tools and resources to make it easy for countries to use it to strengthen their own administrative systems. Ultimately, this will allow global scale-up to all developing countries that find it useful.

# Development of the Dashboard Instruments
The dashboard project collects new data in each country using three new instruments:  A School Survey, a Policy Survey, and a Survey of Public Officials. Data collection involves school visits, classroom observations, legislative reviews, teacher and student assessments, and interviews with teachers, principals, and public officials. In addition, the project draws on some existing data sources to complement the new data it collects. A major objective of the GEPD project was to develop focused, cost-effective instruments and data-collection procedures, so that the dashboard can be inexpensive enough to be applied (and re-applied) in many countries.  The team achieved this by streamlining and simplifying existing instruments, and thereby reducing the time required for data collection and training of enumerators.  

More information pertaining to each of the three instruments can be found below

## School Survey

The School Survey collects data primarily on Practices (the quality of service delivery in schools), but also on some de facto Policy and school-level Politics indicators.  It consists of streamlined versions of existing instruments—including Service Delivery Surveys on teachers and inputs/infrastructure, TEACH on pedagogical practice, Global Early Child Development Database (GECDD) on school readiness of young children, and the Development World Management Survey (DWMS) on management quality—together with new questions to fill gaps in those instruments.  Though the number of modules is similar to the full version of the Service Delivery Indicators (SDI) Survey, the number of items and the complexity of the questions within each module is significantly lower. The School Survey includes 8 short modules: School Information, Teacher Presence, Teacher Survey, Classroom Observation, Teacher Assessment, Early Learner Direct Assessment, School Management Survey, and 4th Grade Student Assessment. For a team of two enumerators, it takes on average about 4 hours to collect all information in a given school. For more information, refer to the Frequently Asked Questions. 

### Student Learning Assessment

The SDI student test was designed as a one-on-one evaluation with enumerators reading out instructions to students in their mother tongue. This was done so as to build up a differentiated picture of students’ cognitive skills; i.e. oral one-to-one testing which allows testing whether a child can solve a mathematics problem even when his/her reading ability is so low that he/she would not be able to attempt the problem independently. The language test (implemented in the language of instruction: English, French, Swahili, or Portuguese) ranged from simple tasks testing letter and word recognition to a more challenging reading comprehension test.  The mathematics test ranged from recognizing and ordering numbers, to addition of one- to three-digit numbers, to one- and two-digit subtraction, to single digit multiplication and division.

### Teacher Content Knowledge Assessment

The objective of the teacher test is three-fold. The first objective is to examine whether teachers have the mastery of the subjects they are teaching. This is interpreted as the minimum knowledge required for the teacher to be effective. In addition, the test also examines the extent to which teachers demonstrate mastery of subject content skills that are above the level they are teaching at and finally, mastery of pedagogic skills.

To simplify the administration of the test it was designed as a marking exercise, in which teachers are asked to mark and correct a hypothetical student's exam. The Language test was administered to teachers teaching language, or language and other subjects, and the mathematics test was administered to teacher teaching mathematics, or mathematics and other subjects. The test was validated against 13 Sub-Saharan primary curricula.^[The countries included for the review were: Botswana, Ethiopia, Gambia, Kenya, Magadascar, Mauritius, Namibia, Nigeria, Rwanda, Seychelles, South Africa, Tanzania and Uganda. See David Johnson, Andrew Cunningham and Rachel Dowling (2012) ``Teaching Standards and Curriculum Review'', prepared as background document for the SDI Survey.] ^[While some SDI countries were not part of the review, before doing the SDI survey the SDI team verified that the school curriculum was compatible with the SDI teacher and student test. For more information see SDI Technical report for each specific country.[}]

The language test consisted of two sections. The first section asked teachers to assess pupil language literacy by correcting a primary school pupil language test. The teachers have to correct whether the ``student answer'' is correct, and in case it is incorrect, has to write the correct answer. The second section asks teachers to correct a letter written by a child in 4th grade. The teachers have to correct the letter for grammar, punctuation (between sentences and within sentences), spelling, syntax, and salutation by circling the mistakes and writing the correction on the line.

The mathematics test asks teachers to assess pupil numeracy literacy by correcting a primary school pupil mathematic test. The teachers have to correct whether the ``student answer'' is correct, and in case it is incorrect it has to write the correct answer.

The pedagogy test consists of three sections designed to capture all the skills teachers would routinely be asked to apply when teaching. The first section asks teachers to prepare a lesson plan about road accidents based on a simple information given a text they had read. The second task asks teachers to assess children's writing on the basis of two sample letters (written by grade 4 children). Teachers have to point out the strengths and weaknesses on the student's letters, by evaluating  pupil's ability to write simple letters, use sentence structures correctly including past and present tenses, use a range of vocabulary, and use both within and between sentence punctuation.  The final task asks teachers to inspect test scores of 10 children, aggregate them and make some statements about learning patterns.
### 1st Grade Assessment

### TEACH Pedagogy Assessment

Teach is a free classroom observation tool that provides a window into one of the less explored and more important aspects of a student’s education: what goes on in the classroom. The tool is intended to be used in primary classrooms (grades 1-6) and was designed to help low- and middle-income countries track and improve teaching quality.

Teach captures practices that nurture children’s cognitive and — for the first time — socioemotional skills.Teach is the first tool to holistically measure what happens in the classroom. It does so by considering not just time spent on learning but, more importantly, the quality of teaching practices.

Teach was developed with low- and middle-income countries in mind and can be contextualized for different settings. For instance, additional elements can be added at the request of the government and local video footage is used to train observers on the tool.
Teach includes a complementary toolkit that helps teams conduct the training with a detailed script and training guide, collect data using a data collection app available in several languages, and clean and analyze data with automatized programs — including assessing the validity of Teach scores. A template report to help communicate the results is also available.
Teach and all its complementary toolkit is free.
In addition to its tailored design, Teach underwent a rigorous development and validation process over a 2-year timeframe. The tool was piloted in over 1,000 classrooms across Mozambique, Pakistan, the Philippines, and Uruguay, and tested with global video footage from 12 low- and middle-income countries. Analyses of the training data indicate that after only 4 days, almost 90% of participants passed the Teach Reliability Exam, which involves coding 3 videos reliably. Please contact us if you’d like more information on the tool’s interrater reliability and other metrics of validation.
For more information on the Teach project please see:

https://www.worldbank.org/en/topic/education/brief/teach-helping-countries-track-and-improve-teaching-quality

## Principal Questionnaire

## Teacher Questionnaire

## Survey of Public Officials
The Survey of Public Officials collects information about the capacity and orientation of the bureaucracy, as well as political factors affecting education outcomes. This survey is a streamlined and education-focused version of the civil-servant surveys that the Bureaucracy Lab (a joint initiative of the Governance Global Practice and the Development Impact Evaluation unit of the World Bank) has implemented recently in several countries. The survey includes questions about technical and leadership skills, work environment, stakeholder engagement, impartial decision-making, and attitudes and behaviors. The survey takes 40-60 minutes per public official and is used with those working at the central, regional, and district level of the Ministry of Education of each country. 

## Policy Survey

 The Policy Survey collects information to feed into the Policy de jure indicators. This survey is filled out by key informants in each country, drawing on their knowledge to identify key elements of the policy framework (as in the SABER approach to policy-data collection that the Bank has used over the past 7 years).  The survey includes questions on policies related to teachers, school management, inputs and infrastructure, and learners. In total, there are 52 questions in the survey as of January 2020. 

## Final Notes
While most dashboard indicators are derived from data collected using these instruments, the team also draws on existing data for a small number of indicators.  This is particularly key for Outcome data (school participation and learning), where the team reports on existing data wherever possible. Similarly, because factors outside the education system also affect education outcomes, the dashboard also includes a few indicators based on existing data from other sectors.  For example, many factors that affect whether children are in school and ready to learn lie outside the education system.  Thus, policy levers for this Practice area include indicators like the rate of children attending early childhood education programs, the share of children that are fully immunized, among others. Please refer to the Detailed Indicator Information for more details.


# Sampling

## General Notes on Sampling
The aim of the Global Education Policy Dashboard school survey is to produce nationally representative estimates, which will be able to detect changes in the indicators over time at a minimum power of 80% and with a 0.05 significance level.  We also wish to detect differences by urban/rural location. 

For our school survey, we will employ a two-stage random sample design, where in the first stage a sample of typically around 200 schools, based on local conditions, is drawn, chosen in advance by the Bank staff.  In the second stage, a sample of teachers and students will be drawn to answer questions from our survey modules, chosen in the field.  A total of 10 teachers will be sampled for absenteeism.  Five teachers will be interviewed and given a content knowledge exam.  Three 1st grade students will be assessed at random, and a classroom of 4th grade students will be assessed at random.  Stratification will be based on the school’s urban/rural classification and based on region. When stratifying by region, we will work with our partners within the country to make sure we include all relevant geographical divisions. 

For our Survey of Public Officials, we will sample a total of 200 public officials.  Roughly 60 officials are typically surveyed at the federal level, while 140 officials will be surveyed at the regional/district level.  For selection of officials at the regional and district level, we will employ a cluster sampling strategy, where roughly 10 regional offices (or whatever the secondary administrative unit is called) are chosen at random from among the regions in which schools were sampled.  Then among these 10 regions, we also typically select around 10 districts (tertiary administrative level units) from among the districts in which schools werer sampled.  The result of this sampling approach is that for 10 clusters we will have links from the school to the district office office to the regional office to the central office.  Within the regions/districts, five or six officials will be sampled, including the head of organization, HR director, two division directors from finance and planning, and one or two randomly selected professional employees among the finance, planning, and one other service related department chosen at random.  At the federal level, we will interview the HR director, finance director, planning director, and three randomly selected service focused departments.  In addition to the directors of each of these departments, a sample of 9 professional employees will be chosen in each department at random on the day of the interview.

## Detailed Sampling Notes

Our team consulted with several sampling experts at the World Bank to discuss strategies for sampling schools.  As mentioned, the goal of our survey is to be able to detect differences across time and by urban/rural location.  The result of our consultation with experts was to use an optimal stratification strategy based on the optimal stratified sampling technique in Barcaroli (2014) which uses the genetic algorithm to produce an optimal number of strata and an optimal number of units within strata.  Optimal stratification can lead to reduced sampling error compared to alternative approaches such as cluster sampling or simple random sampling.  

Before producing the sample using the optimal stratification approach, we would define the sampling frame.  Typically, we would take all schools with at least three 1st grade and at least three 4th grade students, according to the latest school census, for inclusion in the frame.  Depending on the country, we may or may not include private schools in the sampling frame depending on the particular country context.  The decision to include private schools is usually determined by the share of private schools that make up the total student enrollment and the ease with which we are able to enter private schools in the country.  We work with the government and the local World Bank team in making this decision.  In Peru, we included only public schools in the sampling frame, because private schools make up only a small percentage of total student enrollment.

In our stratified sampling approach, we typically use a countries 1st or 2nd level administative division (which usually is a province or department) depending on the country and the urban/rural status of the school as stratification variables.  For example, in Peru, the Departamento and urban/rural status of the school made up the stratification variables.  In cases, where private schools are also included in the sampling frame, the public/private status of the school is also included as a stratification variable.

The optimal stratification apporach is particularly useful if previous surveys have been done in the country which collect information similar to the information collected in our Dashboard.  The optimal stratification algorith will assign extra units to a stratum that has a particularly variance in our target variables.  For instance in Peru, we used data from a previous nationally representative survey which used the MELQO instrument to test Early Childhoold skills.  We were able to calculate the mean and standard deviation of the student level test scores by departamento, and we were able to assign extra sampling units to stratum with relatively high variances in these outcomes. To the extent that regions with a high variance in the MELQO test also have a high variance in our other outcomes (such as the 4th grade test scores, teacher knowledge, principal practices), we would expect this sampling approach to improve precision in these measures as well.

A quick introduction to the technical aspects of the opimal stratification approach can be found here.

https://cran.r-project.org/web/packages/SamplingStrata/vignettes/SamplingStrata.html

In all cases, where the optimal stratification algorithm was applied, we also in paralell ran a sampling approach based on a more simple stratified sampling approach where units were broken into strata and the number of units per strata was proportionate to the stratum size.  Typically, we did not find major differences in the summary statistics of the sample (in terms of average numbers of students per school, or number of schools per region) based on the optimal stratification approach compared to a more simple stratification approach.

Barcaroli G (2014). “SamplingStrata: An R Package for the Optimization of Stratified Sampling.” Journal of Statistical Software, 61(4), 1–24. http://www.jstatsoft.org/v61/i04/.



### Peru Specific Comments

MELQO data was merged with the Peru school frame in order to optimally stratify.  We stratified on the basis of urban/rual and department.  There are 25 departments in Peru. In 2017, Peru conducted an examination of around 4,500 children between 5 and 8 years old, with a median age of 6.  The MELQO exam is quite similar to our ECD examination module.  We are able to use data from this 2017 survey to choose the number of schools in each province optimally by calculating means and standard deviations by province and feeding this information into the optimal stratification algorithm.  See https://cran.r-project.org/web/packages/SamplingStrata/vignettes/SamplingStrata.html.  Provinces with low standard deviations among students in terms of their MELQO development scores are allocated fewer schools compared to an allocation that is simply based on population, and provinces with high standard deviations are allocated more schools.  

205 schools were chosen for our survey after optimally stratifying.  

To see more detailed notes on our sampling approach in Peru, please see:
https://github.com/worldbank/GEPD/blob/develop/Data/Peru/2019/Data/sampling/Sampling_Notes_Peru.html 

and

https://github.com/worldbank/GEPD/blob/develop/Data/Peru/2019/Data/sampling/SamplingStrata_Peru_shared.R

### Jordan  Specific Comments

For our school survey, we select only schools that are supervised by the Minsitry or Education or are Private schools.  No schools supervised by the Ministry of Defense, Ministry of Endowments, Ministry of Higher Education , or Ministry of Social Development are included.  This left us with a sampling frame containing 3,330 schools, with 1297 private schools and 2003 schools managed by the Minsitry of Education. The schools must also have at least 3 grade 1 students, 3 grade 4 students, and 3 teachers.

We oversampled Southern schools to reach a total of 50 Southern schools for regional comparisons.  Additionally, we oversampled Evening schools, for a total of 40 evening schools.

To see more detailed notes on our sampling approach, please see:
https://github.com/worldbank/GEPD/blob/develop/Data/Jordan/2019/Sampling/Sampling_Notes_Jordan.html
and

https://github.com/worldbank/GEPD/blob/develop/Data/Jordan/2019/Sampling/SamplingStrata_v2.R

### Mozambique  Specific Comments

Our sampled schools come from the list of schools surveyed by the 2018 SDI survey.  Because we were supplementing data that was collected as part of the 2018 SDI, we chose from among the schools sampled for this survey.  For public officials, the sampling was similar as described above.

To see more detailed notes on our sampling approach, please see:
https://github.com/worldbank/GEPD/blob/develop/Data/Mozambique/2019/Code/Sampling_Notes_Mozambique.html

and

https://github.com/worldbank/GEPD/blob/develop/Data/Mozambique/2019/Code/SamplingStrata_Mozambique.R

### Rwanda Specific Comments

In order to visit two schools per day, we clustered at the sector level choosing two schools per cluster.  With a sample of 200 schools, this means that we had to allocate 100 PSUs.  We combined this clustering with stratification by district and by the urban rural status of the schools.  The number of PSUs allocated to each stratum is proportionate to the number of schools in each stratum (i.e. the district X urban/rural status combination).  


To see more detailed notes on our sampling approach, please see:
https://github.com/worldbank/GEPD/blob/develop/Data/Rwanda/2019/Data/Sampling/Sampling_Notes.html

and

https://github.com/worldbank/GEPD/blob/develop/Data/Rwanda/2019/Data/Sampling/SamplingStrata.R

### Punjab Specific Comments
The survey in Pubjab is a combined effort of the Early Learning Partnership project and of the Global Education Policy Dashboard project.  

Overall, we draw a sample of 200 public schools, 200 private schools and 200 public-private partnership (PPP) schools.  We  stratified by urban/rural.  

At this stage it is important to note, that there are certain districts which we may not be able to visit due to security concerns, these are:

* Mianwali
* Dera Ghazi Khan (DG Khan)
* Rajan Pur
* Bhakkar

We have removed these districts from the sampling frame.  

Out of the 200 public schools to be surveyed we would like approximately 100 of these schools to be schools that are meeting ECE quality standards (in the data set this corresponds to public_strata==1).  Out of the remaining public schools to be sampled, 50 schools will be schools that have ECE but do not meet quality standards (public_strata==2) and 50 will be schools that have no ECE at all, and have only have katchi classes (public_strata==3). 




Due to operational constraints, we did not draw a random sample of all schools at province level.  We selected six districts for the survey (out of 32).   The survey team drew a convenience sample of 6 districts that is representative of North, Central and South Punjab, which includes both richer and poorer districts. A convenience sample was appropriate due to security and operational constraints of working in Punjab. The selected districts were:

* Attock
* Faisalabad
* Lahore 
* Muzaffargarh 
* Rahimyar Khan
* Sargodha  

In order to deal with potential refusals and closed schools, a set of replacement schools was also drawn. Within the final strata, schools were sampled proportional to size (number of total enrolled children in pre-primary). 

To see more detailed notes on our sampling approach, please see:
https://github.com/worldbank/GEPD/blob/develop/Data/Pakistan_Punjab/2019/Code/Sampling/Sampling_Notes_Punjab.html

and

https://github.com/worldbank/GEPD/blob/develop/Data/Pakistan_Punjab/2019/Code/Sampling/SamplingStrata.R

## Power Considerations

In order to assess the likely detectable effect sizes for some of our key indicators, we incorporated data from previous surveys that used a similar methodology as the Global Education Policy Dashboard.  We examined the likely detectable effect sizes for the following indicators: absenteeism, teacher content knowledge, 4th grade student knowledge, Early Childhood Development, and Teacher pedagogical skills.


For absenteeism, we used data previously collected as part of the Service Delivery Indicators (SDI) survey (https://www.sdindicators.org/).  Data came from the countries of Afghanistan (SABER SD), Tanzania, Kenya, Mozambique, Nigeria, Uganda, and Senegal.  In each country, data on teacher presence was collected using a very similar questionnaire.  One difference is that for the SDI survey absence was collected during a second unannounced visit to the school.  In our case, we notify the school that a team of enumerators will be coming by the school over a two week period, but do not give them the exact day.  Setting aside this difference, we were able to calculate the intra-class correlation (ICC) in absence for teachers within the same school for each country and using these ICCs exame expected detectable effect sizes by # of schools sampled.  With a benchmark of around 200 schools, we expect to detect differences between two years of between 0.06-0.08 percentage points in absenteeism.

![absence_power](C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/absence_power_schools.png)

For teacher content knowledge, we used the same data sources and a similar methodology to find that in terms of absence, we would be likely to detect


![tknow_power](C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/know_power_schools.png)

![sknow_power](C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/stud_know_power_schools.png)

![ecd_power](C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/ecd_power_schools.png)

![teach_power](C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/teach_power_schools.png)


```{r confidence_intervals_peru, echo=FALSE, message=FALSE, warning=FALSE}

peru_stats<-read_csv("C:/Users/wb469649/Documents/Github/GEPD/Technical_Note/Global Education Policy DashboardGEPD Data Explorer.csv") %>%
  select(-c("Ratio of Rural to Urban"))

#caption
peru_cap<-tab_num(name="peru_cap", caption="Summary Statistics and Confidence Intervals for Dashboard Indicators - Peru 2019")

kable(peru_stats,
      caption=peru_cap,
      col.names = c("Indicator", "Value Range", "Overall Mean", "95% CI", "Urban Mean", "95% CI", "Rural Mean", "95% CI" ))

```

## Survey Weights

# Data Collection
## Survey Solutions
## Anonymization

# Data Quality Checks

# Indicator Construction

```{r echo=FALSE, message=FALSE, warning=FALSE}

indicators_dir <- "C:/Users/wb469649/Documents/Github/GEPD/Indicators/"

    #Get metadata from github
    indicator_choices<-read_delim(paste(indicators_dir, 'indicators_choices.md',sep=""), delim="|", trim_ws=TRUE)
    
    #Display metadata for indicator
    indicator_choices <- indicator_choices %>%
      dplyr::select(-X1, -X6) %>%
      dplyr::filter(Series!="---") 
    
    names(indicator_choices)<-make.names(names(indicator_choices), unique=TRUE)
    
    
  #produce caption for table
  indicator_choices_captioner<-tab_num(name="indicator_choices_cap", caption="High Level Description of How Each Indicator is Scored")
  
  #Produce table
  indicator_choices %>% 
    select(Indicator.Name, Value, How.is.the.indicator.scored.) %>%
    kable(caption=indicator_choices_captioner,
          col.names =c( "Indicator Name", "Values", "How Indicator is Scored")) 

```


# Data Visualization Tools

# Appendix
## Psychometric Properties of 4th Grade Assessment
For a full report on the psychometric properties of our assessment in Peru, see:

https://worldbankgroup-my.sharepoint.com/:u:/g/personal/bstacy_worldbank_org/EeI0nmjm-MlLl3OyPAfOzdsB0VBT7v-Q1JHrwig3H2FMEw?e=Pq2Fzg

## Psychometric Properties of 1st Grade Assessment
For a full report on the psychometric properties of our assessment in Peru, see:

https://worldbankgroup-my.sharepoint.com/:u:/g/personal/bstacy_worldbank_org/EcwUNOUuTE1Ltjow7o10AUQBulnO_kKRPR0Oh8yTv5l7MA?e=miiiZU


## Psychometric Properties of Teacher Assessment
For a full report on the psychometric properties of our assessment in Peru, see:

https://worldbankgroup-my.sharepoint.com/:u:/g/personal/bstacy_worldbank_org/EbHd7iWaxGhJspphCXLqkfwBAlzQ0hUjtUb8uT151CxL-A?e=82bgKE


## Detailed Indicator Construction

Below is a list of the primary indicators and sub-indicators used to construct our final indicators.

```{r subindicators, echo=FALSE}

 ind_list <-c('student_knowledge', 
                'math_student_knowledge', 
                'literacy_student_knowledge', 
                'student_proficient', 
                'literacy_student_proficient', 
                'math_student_proficient', 
                'student_proficient_70',  
                'student_proficient_75',
             'student_attendance',
             'presence_rate',  
             'absence_rate', 
             'school_absence_rate', 
             'content_proficiency', 
             'literacy_content_proficiency', 
             'math_content_proficiency', 
             'content_proficiency_70', 
             'content_proficiency_75', 
             'content_knowledge', 
             'math_content_knowledge', 
             'literacy_content_knowledge', 
             'grammar', 
             'cloze',  
             'read_passage', 
             'arithmetic_number_relations', 
             'geometry', 
             'interpret_data',
             'ecd_student_knowledge', 
             'ecd_math_student_knowledge', 
             'ecd_literacy_student_knowledge', 
             'ecd_exec_student_knowledge', 
             'ecd_soc_student_knowledge',
             'ecd_student_proficiency', 
             'ecd_math_student_proficiency',
             'ecd_literacy_student_proficiency', 
             'ecd_exec_student_proficiency', 
             'ecd_soc_student_proficiency',
             'inputs', 
             'blackboard_functional', 
             'pens_etc',
             'textbooks', 
             'share_desk', 
             'used_ict', 
             'access_ict',
             'infrastructure',
             'drinking_water', 
             'functioning_toilet', 
             'internet', 
             'class_electricity',
             'disability_accessibility',
             'operational_management',
             'vignette_1', 
             'vignette_2', 
             'intrinsic_motivation', 
             'acceptable_absent', 
             'students_deserve_attention', 
             'growth_mindset', 
             'motivation_teaching',
             'instructional_leadership', 
             'classroom_observed', 
             'classroom_observed_recent', 
             'discussed_observation', 
             'feedback_observation', 
             'lesson_plan_w_feedback',
             'principal_knowledge_score', 
             'add_triple_digit_pknw', 
             'multiply_double_digit_pknw', 
             'complete_sentence_pknw', 
             'experience_pknw', 
             'textbooks_pknw', 
             'blackboard_pknw',
             'principal_management', 
             'school_goals_exist',
             'school_goals_clear',
             'school_goals_relevant',
             'school_goals_measured',
             'teacher_attraction', 
             'teacher_satisfied_job', 
             'teacher_satisfied_status', 
             'better_teachers_promoted' ,
             'teacher_bonus', 
             'salary_delays',
             'teacher_selection_deployment', 
             'teacher_selection',
             'teacher_deployment',
             'teacher_support', 
             'pre_service',
             'practicum',
             'in_service',
             'opportunities_teachers_share',
             'teaching_evaluation', 
             'formally_evaluated', 
             'evaluation_content', 
             'negative_consequences',
             'positive_consequences',
             'teacher_monitoring',
             'attendance_evaluated' ,
             'attendance_rewarded' , 
             'attendence_sanctions', 
             'miss_class_admin',
             'standards_monitoring',
             'school_monitoring', 
             'monitoring_inputs',
             'monitoring_infrastructure',
             'parents_involved',
             'school_management_clarity', 
             'infrastructure_scfn',
             'materials_scfn',
             'hiring_scfn', 
             'supervision_scfn', 
             'student_scfn' , 
             'principal_hiring_scfn', 
             'principal_supervision_scfn',
             'school_management_attraction', 
             'principal_satisfaction', 
             'principal_salary',
             'school_selection_deployment', 
             'school_support', 
             'prinicipal_trained',
             'principal_training',
             'principal_used_skills',
             'principal_offered',
             'principal_evaluation', 
             'principal_formally_evaluated',
             'principal_evaluation_multiple',
             'principal_negative_consequences',
             'principal_positive_consequences',
             'national_learning_goals', 
             'targeting', 
             'monitoring', 
             'incentives', 
             'community_engagement',
             'mandates_accountability' , 
             'coherence', 
             'transparency', 
             'accountability', 
             'quality_bureaucracy', 
             'knowledge_skills', 
             'work_environment', 
             'merit', 
             'motivation_attitudes',
             'motivation_relative_start',
             'impartial_decision_making',
             'politicized_personnel_management',
             'politicized_policy_making', 
             'politicized_policy_implementation', 
             'employee_unions_as_facilitators'
 )
 
 indicator_labels<-c("4th Grade Student Knowledge", 
                     "4th Grade Math Knowledge", 
                     "4th Grade Literacy Knowledge", 
                     "4th Grade Student Proficiency", 
                     "4th Grade Student Proficiency Literacy",
                     "4th Grade Student Proficiency Math",
                     "4th Grade Student Proficiency at 70% threshold",  
                     "4th Grade Student Proficiency at 75% threshold",
                     "Student Attendance Rate",
                     "Teacher Classroom Presence Rate ", 
                     "Teacher Classroom Absence Rate ", 
                     "Teacher School Absence Rate", 
                     "Teacher Content Proficiency", 
                     "Teacher Content Proficiency Literacy", 
                     "Teacher Content Proficiency Math", 
                     "Teacher Content Proficiency at 70% threshold", 
                     "Teacher Content Proficiency at 75% threshold", 
                     "Teacher Content Knowledge", 
                     "Teacher Math Content Knowledge", 
                     "Teacher Literacy Content Knowledge", 
                     'Grammar', 
                     'Cloze Task',  
                     'Read Passage', 
                     'Arithmetic & Number Relations', 
                     'Geometry', 
                     'Interpret Data',
                     "1st Grade Assessment Score", 
                     "1st Grade Numeracy Score", 
                     "1st Grade Literacy Score", 
                     "1st Grade Executive Functioning Score", 
                     "1st Grade Socio-Emotional Score",
                     "1st Grade Assessment Proficiency", 
                     "1st Grade Numeracy Proficiency", 
                     "1st Grade Literacy Proficiency", 
                     "1st Grade Executive Functioning Proficiency", 
                     "1st Grade Socio-Emotional Proficiency",
                     "Inputs", 
                     "Functioning Blackboard (Based on classroom observation: Is there a blackboard, Is there chalk, and Is there sufficient light", 
                     "Classroom Materials (Pens, Pencils, Exercise Books)", 
                     "Textbooks", 
                     "Desks", 
                     "ICT Usage", 
                     "ICT Access",
                     "Infrastructure", 
                     "Clean Drinking Water", 
                     "Functioning Toilets", 
                     "Internet", 
                     "Electricity", 
                     "Disability Accessibility", 
                     "Operational Management", 
                     "Operational Management - Vignette 1",  
                     "Operational Management - Vignette 2",
                     "Teacher Intrinsic Motivation", 
                     'Scores on set of questions to teachers on whether it is ever acceptable to be absent', 
                     'Scores on set of questions to teachers on whether some students deserve more attention than others', 
                     'Scores on questions related to growth mindset', 
                     'Motivation to teach based on whether teacher joined teaching just for job security',
                     "Instructional Leadership", 
                     'Whether or not classroom has been observed', 
                     'Whether observation took place in last 12 months', 
                     'Whether teacher discussed classroom observation with principal/head teacher', 
                     'Whehter feedback was given on classroom observation and converation lasted more than 30 min', 
                     'Whether teacher had feedback on lesson plan',
                     'Principal Knowledge of School', 
                     'Correct on # of Teachers correct on Triple Digit Addition', 
                     'Correct on # of Teachers correct on Double Digit Multiplication', 
                     'Correct on # of Teachers correct on Completing Sentence Question', 
                     'Correct on # of Teachers Under 3 Years Experience', 
                     'Correct on # of Students with Textbooks ', 
                     'Correct on Functional Blackboard',
                     'Principal Management Skills', 
                     'According to Principal: School Goals Exist',
                     'According to Principal:  to Principal: School Goals Clear',
                     'According to Principal: School Goals Relevant',
                     'According to Principal: School Goals Measured',
                     'Teacher Attraction (De Facto)', 
                     'Teacher Satisfied with Job', 
                     'Teachers Satisfied with Status in Community', 
                     'Teacher perceives that better teachers more likely to be promoted' ,
                     'Teacher received bonus in past year', 
                     'Salary Delays reported by teacher',
                     'Teacher Selection & Deployment (De Facto)', 
                     'Teacher recruited based on passing written content knowledge test, passed interview stage assessment, passed an assessment conducted by supervisor based on practical experience, conduct during mockup class',
                     'Teacher deployed based on performance assessed by school authority, colleagues, or external evaluator, results of interview.',
                     'Teacher Support (De Facto)', 
                     'Had pre-service training and teacher reported finding it useful',
                     'Had a practicum and training lasted multiple days',
                     'Had in-service training that lasted more than 2 days and had a component that took place in classroom ',
                     'Whether teacher reported having opportunities to come together and share ways of improving teaching',
                     'Teacher Evaluation (De Facto)', 
                     'Teacher reported being formally evaluated', 
                     'Evaluation had multiple components', 
                     'Teacher reported negative consequences would occur if received 2 or more negative evaluations',
                     'Teacher reported positive consequences would occur if received 2 or more positive evaluations',
                     'Teacher Monitoring & Accountability (De Facto)', 
                     'Teachers evaluated by some authority on basis of absence' , 
                     'Teacher reported good attendance is rewarded. ' , 
                     'Teacher reported there are consequences for chronic absence (more than 30% absence)', 
                     'Teacher reported having to miss class for administrative reasons',
                     'Inputs and Infrastructure Standards',
                     "Inputs and Infrastructure Monitoring", 
                     'Fraction of inputs Principal reported being monitored (functioning blackboard, chalk, pens, pencils, textbooks, exercise books in 4th grade classrooms, basic classroom furniture, and at least one computer in the schools)',
                     'Fraction of infrastructure elements Principal reported being monitored (functioning toilets, electricity, drinking water, and accessibility for people with disabilities)',
                     'Principal reports community involved in the monitoring',
                     "School Management Clarity of Functions", 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Maintenance of Infrastructure',
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Procurement of materials',
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Teacher hiring and assignment', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Teacher supervision, training, and coaching', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Student Learning Assessments' , 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Principal hiring and assignment', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Principal Supervision and training',
                     "School Management Attraction", 
                     'Principal satisfied with status in community', 
                     'Principal reported salary as fraction of GDP',
                     "School Management Selection & Deployment",
                     "School Management Support", 
                     'Principal reported receiving formal training on managing school',
                     'Principal had received the following training (1/3 point for each): Management training for new principals, in-service training, mentoring coaching',
                     'Principal reported using skills from training',
                     'Principal reported offered training at least once per year',
                     "School Management Evaluation", 
                     'Principal reported being formally evaluated',
                     'Principal evaluation based on multiple components (at least 5 components for full credit',
                     'Principal reported negative consequences would occur if received 2 or more negative evaluations',
                     'Principal reported negative consequences would occur if received 2 or more negative evaluations',
                     "National Learning Goals", 'Targeting', 'Monitorinig', 'Incentives', 'Community Engagement',
                     "Mandates and Accountability", 'Coherence', 'Transparency', 'Accountability of Public Officials',
                     "Quality of Bureaucracy", 'Knowledge and Skills', 'Work Environment', 'Merit', 'Motivation and Attitudes', 'Motivation Relative to Starting Public Service',
                     "Impartial Decision Making", 'Politicized personnel management', 'Politicized policy-making', 'Politicized policy-implementation', 'Employee unions as facilitators'
 )
 
 indicator_module<-c("4th Grade Student Assessment", 
                     "4th Grade Student Assessment", 
                     "4th Grade Student Assessment",  
                     "4th Grade Student Assessment", 
                     "4th Grade Student Assessment", 
                     "4th Grade Student Assessment", 
                     "4th Grade Student Assessment",   
                     "4th Grade Student Assessment", 
                     "Student Roster and Classroom Observation",
                     "Teacher Roster and School Inspection", 
                     "Teacher Roster and School Inspection", 
                     "Teacher Roster and School Inspection", 
                     "Teacher Assessment", 
                     "Teacher Assessment", 
                     "Teacher Assessment", 
                     "Teacher Assessment", 
                     "Teacher Assessment",  
                     "Teacher Assessment", 
                     "Teacher Assessment",  
                     "Teacher Assessment",  
                     "Teacher Assessment",  
                     "Teacher Assessment",   
                     "Teacher Assessment",  
                     "Teacher Assessment",  
                     "Teacher Assessment", 
                     "Teacher Assessment", 
                     "1st Grade Direct Assessment", 
                     "1st Grade Direct Assessment",
                     "1st Grade Direct Assessment", 
                     "1st Grade Direct Assessment", 
                     "1st Grade Direct Assessment",
                     "1st Grade Direct Assessment",
                     "1st Grade Direct Assessment", 
                     "1st Grade Direct Assessment",
                     "1st Grade Direct Assessment", 
                     "1st Grade Direct Assessment",
                     "Classroom Observation", 
                     "Classroom Observation",
                     "Classroom Observation", 
                     "Classroom Observation",
                     "Classroom Observation", 
                     "Teacher Inverview", 
                     "School Inspection",
                     "School Inspection", 
                     "School Inspection",
                     "School Inspection", 
                     "School Inspection",  
                     "School Inspection",  
                     "School Inspection",  
                     "Principal Interview", 
                     "Principal Interview",   
                     "Principal Interview", 
                     "Teacher Interview", 
                     "Teacher Interview",  
                     "Teacher Interview", 
                     "Teacher Interview",  
                     "Teacher Interview", 
                     "Teacher Interview",  
                     "Teacher Interview", 
                     "Teacher Interview",  
                     "Teacher Interview", 
                     "Teacher Interview",  
                     "Teacher Interview", 
                     'Principal Interview', 
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Teacher Interview', 
                     'Teacher Interview', 
                     'Teacher Interview', 
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview', 
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview', 
                     'Teacher Interview',
                     'Teacher Interview',
                     'Teacher Interview', 
                     'Teacher Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview',
                    'Principal Interview',
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview', 
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     'Principal Interview',
                     "Public Official Interview", 'Public Official Interview', 'Public Official Interview', 'Public Official Interview', 'Public Official Interview',
                     "Public Official Interview", 'Public Official Interview', 'Public Official Interview', 'Public Official Interview',
                     "Public Official Interview", 'Public Official Interview', 'Public Official Interview', 'Public Official Interview', 'Public Official Interview', 'Public Official Interview',
                     "Public Official Interview", 'Public Official Interview', 'Public Official Interview', 'Public Official Interview', 'Public Official Interview'
 ) 
 
 
  survey_variables<-c("4th Grade Student Knowledge", 
                     "4th Grade Math Knowledge", 
                     "4th Grade Literacy Knowledge", 
                     "4th Grade Student Proficiency", 
                     "4th Grade Student Proficiency Literacy",
                     "4th Grade Student Proficiency Math",
                     "4th Grade Student Proficiency at 70% threshold",  
                     "4th Grade Student Proficiency at 75% threshold",
                     "Student Attendance Rate",
                     "Teacher Classroom Presence Rate ", 
                     "Teacher Classroom Absence Rate ", 
                     "Teacher School Absence Rate", 
                     "Teacher Content Proficiency", 
                     "Teacher Content Proficiency Literacy", 
                     "Teacher Content Proficiency Math", 
                     "Teacher Content Proficiency at 70% threshold", 
                     "Teacher Content Proficiency at 75% threshold", 
                     "Teacher Content Knowledge", 
                     "Teacher Math Content Knowledge", 
                     "Teacher Literacy Content Knowledge", 
                     'Grammar', 
                     'Cloze Task',  
                     'Read Passage', 
                     'Arithmetic & Number Relations', 
                     'Geometry', 
                     'Interpret Data',
                     "1st Grade Assessment Score", 
                     "1st Grade Numeracy Score", 
                     "1st Grade Literacy Score", 
                     "1st Grade Executive Functioning Score", 
                     "1st Grade Socio-Emotional Score",
                     "1st Grade Assessment Proficiency", 
                     "1st Grade Numeracy Proficiency", 
                     "1st Grade Literacy Proficiency", 
                     "1st Grade Executive Functioning Proficiency", 
                     "1st Grade Socio-Emotional Proficiency",
                     "Inputs", 
                     "Functioning Blackboard (Based on classroom observation: Is there a blackboard, Is there chalk, and Is there sufficient light", 
                     "Classroom Materials (Pens, Pencils, Exercise Books)", 
                     "Textbooks", 
                     "Desks", 
                     "ICT Usage", 
                     "ICT Access",
                     "Infrastructure", 
                     "Clean Drinking Water", 
                     "Functioning Toilets", 
                     "Internet", 
                     "Electricity", 
                     "Disability Accessibility", 
                     "Operational Management", 
                     "Operational Management - Vignette 1",  
                     "Operational Management - Vignette 2",
                     "Teacher Intrinsic Motivation", 
                     'Scores on set of questions to teachers on whether it is ever acceptable to be absent', 
                     'Scores on set of questions to teachers on whether some students deserve more attention than others', 
                     'Scores on questions related to growth mindset', 
                     'Motivation to teach based on whether teacher joined teaching just for job security',
                     "Instructional Leadership", 
                     'Whether or not classroom has been observed', 
                     'Whether observation took place in last 12 months', 
                     'Whether teacher discussed classroom observation with principal/head teacher', 
                     'Whehter feedback was given on classroom observation and converation lasted more than 30 min', 
                     'Whether teacher had feedback on lesson plan',
                     'Principal Knowledge of School', 
                     'Correct on # of Teachers correct on Triple Digit Addition', 
                     'Correct on # of Teachers correct on Double Digit Multiplication', 
                     'Correct on # of Teachers correct on Completing Sentence Question', 
                     'Correct on # of Teachers Under 3 Years Experience', 
                     'Correct on # of Students with Textbooks ', 
                     'Correct on Functional Blackboard',
                     'Principal Management Skills', 
                     'According to Principal: School Goals Exist',
                     'According to Principal:  to Principal: School Goals Clear',
                     'According to Principal: School Goals Relevant',
                     'According to Principal: School Goals Measured',
                     'Teacher Attraction (De Facto)', 
                     'Teacher Satisfied with Job', 
                     'Teachers Satisfied with Status in Community', 
                     'Teacher perceives that better teachers more likely to be promoted' ,
                     'Teacher received bonus in past year', 
                     'Salary Delays reported by teacher',
                     'Teacher Selection & Deployment (De Facto)', 
                     'Teacher recruited based on passing written content knowledge test, passed interview stage assessment, passed an assessment conducted by supervisor based on practical experience, conduct during mockup class',
                     'Teacher deployed based on performance assessed by school authority, colleagues, or external evaluator, results of interview.',
                     'Teacher Support (De Facto)', 
                     'Had pre-service training and teacher reported finding it useful',
                     'Had a practicum and training lasted multiple days',
                     'Had in-service training that lasted more than 2 days and had a component that took place in classroom ',
                     'Whether teacher reported having opportunities to come together and share ways of improving teaching',
                     'Teacher Evaluation (De Facto)', 
                     'Teacher reported being formally evaluated', 
                     'Evaluation had multiple components', 
                     'Teacher reported negative consequences would occur if received 2 or more negative evaluations',
                     'Teacher reported positive consequences would occur if received 2 or more positive evaluations',
                     'Teacher Monitoring & Accountability (De Facto)', 
                     'Teachers evaluated by some authority on basis of absence' , 
                     'Teacher reported good attendance is rewarded. ' , 
                     'Teacher reported there are consequences for chronic absence (more than 30% absence)', 
                     'Teacher reported having to miss class for administrative reasons',
                     'Inputs and Infrastructure Standards',
                     "Inputs and Infrastructure Monitoring", 
                     'Fraction of inputs Principal reported being monitored (functioning blackboard, chalk, pens, pencils, textbooks, exercise books in 4th grade classrooms, basic classroom furniture, and at least one computer in the schools)',
                     'Fraction of infrastructure elements Principal reported being monitored (functioning toilets, electricity, drinking water, and accessibility for people with disabilities)',
                     'Principal reports community involved in the monitoring',
                     "School Management Clarity of Functions", 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Maintenance of Infrastructure',
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Procurement of materials',
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Teacher hiring and assignment', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Teacher supervision, training, and coaching', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Student Learning Assessments' , 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Principal hiring and assignment', 
                     'Do you know if the policies governing schools assign responsibility for the implementation of each of the following: Principal Supervision and training',
                     "School Management Attraction", 
                     'Principal satisfied with status in community', 
                     'Principal reported salary as fraction of GDP',
                     "School Management Selection & Deployment",
                     "School Management Support", 
                     'Principal reported receiving formal training on managing school',
                     'Principal had received the following training (1/3 point for each): Management training for new principals, in-service training, mentoring coaching',
                     'Principal reported using skills from training',
                     'Principal reported offered training at least once per year',
                     "School Management Evaluation", 
                     'Principal reported being formally evaluated',
                     'Principal evaluation based on multiple components (at least 5 components for full credit',
                     'Principal reported negative consequences would occur if received 2 or more negative evaluations',
                     'Principal reported negative consequences would occur if received 2 or more negative evaluations',
                     "National Learning Goals", 'Targeting', 'Monitorinig', 'Incentives', 'Community Engagement',
                     "Mandates and Accountability", 'Coherence', 'Transparency', 'Accountability of Public Officials',
                     "Quality of Bureaucracy", 'Knowledge and Skills', 'Work Environment', 'Merit', 'Motivation and Attitudes', 'Motivation Relative to Starting Public Service',
                     "Impartial Decision Making", 'Politicized personnel management', 'Politicized policy-making', 'Politicized policy-implementation', 'Employee unions as facilitators'
 )
 
 
 labels_df<-data.frame(indicators=as.character(ind_list),
                       indicator_labels=as.character(indicator_labels),
                       indicator_module=as.character(indicator_module))
 
 
#produce caption for table
data_desc_cap<-tab_num(name="data_desc_cap", caption="Detailed Documentation of Indicators & Sub-Indicators")
kable(labels_df,
      caption=data_desc_cap,
      col.names = c("Variable Name", "Variable Description", "How Was Data Collected?"))

```


We will show a working example of how each indicator is scored in the case of Peru.

```{r peru_data_load, include=FALSE}

#load relevant libraries

library(skimr)
library(naniar)
library(vtable)
library(digest)
library(tidyverse)
library(haven)
library(stringr)
library(Hmisc)

#Country name
country <-'PER'
country_name <- "Peru"
year <- '2019'

#########################
# File paths #
#########################
#The download_folder will be the location of where raw data is downloaded from the API
#The save_folder will be the location of where cleaned data is stored




  project_folder  <- "//wbgfscifs01/GEDEDU/datalib-edu/projects/GEPD/CNT/"

  read_folder <-file.path(paste(project_folder,country,paste(country,year,"GEPD", sep="_"),paste(country,year,"GEPD_v01_M", sep="_"),"Data/School", sep="/"))
  backup_onedrive="no"





load(paste(read_folder,"school_indicators_data_anon.RData", sep="/"))


```

### Teacher Absence


Teacher absence is defined as whether or not the teacher was absenct from the school or classroom during an unannounced visit.  For a working example, see below.  The basis for the question is the following below:

What was the teacher doing when you located him/ her on the first visit?	
1= In classroom- teaching  
2= In classroom- not teaching  
3= At school- teaching outdoors  
4= At school not his/her shift/not her class  
5= At school- not in classroom  
6= Absent from school  


```{r absence}

teacher_absence_ex<-teacher_roster_anon %>%
  select(teacher_number, m2sbq6_efft, teacher_available, m2sbq3_efft) %>%
  filter(!is.na(m2sbq6_efft) | !is.na(m2sbq3_efft) )


#create indicator for whether each teacher was absent from school
teacher_absence_ex <- teacher_absence_ex %>%
  mutate(sch_absence_rate=100*case_when(
    m2sbq6_efft==6 | teacher_available==2 ~ 1,
    m2sbq6_efft!=6   ~ 0,
    is.na(m2sbq6_efft) ~ as.numeric(NA)))

#create indicator for whether each teacher was absent from classroom or school
teacher_absence_ex <- teacher_absence_ex %>%
  mutate(absence_rate=100*case_when(
    m2sbq6_efft==6 | m2sbq6_efft==5 |  teacher_available==2 ~ 1,
    m2sbq6_efft==1 | m2sbq6_efft==3 | m2sbq6_efft==2 | m2sbq6_efft==4  ~ 0,
    is.na(m2sbq6_efft) ~ as.numeric(NA)) )

#create indicator for whether each principal was absent from school
teacher_absence_ex <- teacher_absence_ex %>%
  mutate(principal_absence=100*case_when(
    m2sbq3_efft==8  ~ 1,
    m2sbq3_efft!=8   ~ 0,
    is.na(m2sbq3_efft) ~ as.numeric(NA))) %>%
  mutate(absence_rate=if_else(is.na(absence_rate), principal_absence, absence_rate ),
         sch_absence_rate=if_else(is.na(sch_absence_rate), principal_absence, sch_absence_rate ),
         presence_rate=100-absence_rate)

  #produce caption for table
absence_captioner<-tab_num(name="absence_cap", caption="Data Example of How Absence Scored")
kable(head(teacher_absence_ex, n=5),
      caption=absence_captioner)

label(teacher_absence_ex$m2sbq3_efft)
label(teacher_absence_ex$m2sbq6_efft)
label(teacher_absence_ex$teacher_available)


```
### Student Attendance

Student attendance is based on the classroom observation of a randomly selected fourth grade class.  The teacher is asked for the class roster and the enumerator then takes a count of the students in the classroom.  A working example is below.

```{r Student_Attendance }
#############################################
##### Student Attendance ###########
#############################################

#Percent of 4th grade students who are present during an unannounced visit.

school_data_INPT_ex<- school_dta_anon %>%
  select(m4scq4_inpt, m4scq12_inpt )  %>%
  filter(!is.na(m4scq4_inpt) & !is.na(m4scq12_inpt)) %>%
  mutate(student_attendance=m4scq4_inpt/m4scq12_inpt) %>%
  mutate(student_attendance=100*student_attendance) 
  
#produce caption for table
attendance_cap<-tab_num(name="attendance_cap", caption="Data Example of How Student Attendance Scored")
kable(head(school_data_INPT_ex, n=5),
      caption=attendance_cap)

label(school_data_INPT_ex$m4scq4_inpt)
label(school_data_INPT_ex$m4scq12_inpt)
```

### Teacher Knowledge


The teacher content knowledge score is based on a teacher assessment given to teachers.  The assessment is described in more detail above.  Math teachers were given a mathematics exam and Language teachers were given a separate language exam.  In cases where a teacher taught both subjects, the teacher is randomly given either the math or language exam. The knowledge score is the sum of the items answered correctly out of the total number of items, based on either the math or language assessment as is given.  A detailed scoring example is omitted, because of space, but details on scoring are provided in the GEPD github repo:

https://github.com/worldbank/GEPD

```{r Teacher_Knowledge, eval=FALSE, include=FALSE}
#############################################
##### Teacher Knowledge ###########
#############################################



teacher_assessment_dta_ex <- teacher_assessment_dta_anon %>%
  select(m5sb_tnum, starts_with("m5s1q"), starts_with("m5s2q"))

#calculate teachers lit items correct
teacher_assessment_dta_ex <- teacher_assessment_dta_ex %>%
  mutate(literacy_content_knowledge=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s1q")], na.rm=TRUE),
         correct_letter=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s1q3")], na.rm=TRUE),
         cloze=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s1q2")], na.rm=TRUE),
         grammar=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s1q1")], na.rm=TRUE),
         read_passage=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s1q4")], na.rm=TRUE))

####Math####
#calculate # of math items
teacher_assessment_dta_ex$math_length<-length(grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s2q"))

math_items<-colnames(teacher_assessment_dta_ex[,grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s2q")])

#calculate teachers math items correct
teacher_assessment_dta_ex <- teacher_assessment_dta_ex %>%
  mutate(math_content_knowledge=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="m5s2q")], na.rm=TRUE),
         arithmetic_number_relations=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="number")], na.rm=TRUE),
         geometry=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="geometric")], na.rm=TRUE),
         interpret_data=100*rowMeans(.[grep(x=colnames(teacher_assessment_dta_ex), pattern="data")], na.rm=TRUE))

#produce caption for table
cont_cap<-tab_num(name="cont_cap", caption="Data Example of How Teacher Knowledge Scored")
kable(head(teacher_assessment_dta_ex, n=5),
      caption=cont_cap)


```



### 4th Grade Assessment

Students in a randomly chosen class were given an assessment containing math and language items based on the SDI examination. More details on this examination is above.  A students score is the sum of the literacy sub-score and the math sub-score.  The literacy score is constructed so that each literacy item is given the same weight and is the sum of individual literacy items.  Math scores are calculated similarly.  The final content knowledge score is then the sum of the two components.  A detailed scoring example is omitted, because of space, but details on scoring are provided in the GEPD github repo:

Proficiency is then based on whether the student correctly answered a set number of questions (12/13 in literacy, 14/17 in math), which was determined by consulting a set of experts on whether a minimally proficient 4th grader should be able to answer the questions correctly.  



### ECE Assessment

A randomly selected set of three 1st grade students are given an assessment of early literacy, numeracy, executive functioning and socio-emotional skills.  The assessment was created based on items from the MELQO assessment.  A students score is the sum of the literacy sub-score, the math sub-score, the executive functioning score, and the socio-emotional score.  Each domain (literacy, numeracy, executive functioning and socio-emotional skills) is given equal weight.  Within each domain scores are based on the number of items correct in each domain.  




